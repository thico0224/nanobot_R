<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanobot AI Assistant</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --sidebar-bg: #ffffff;
            --primary: #1a73e8;
            --text-main: #202124;
            --border: #dadce0;
        }

        body { font-family: 'Segoe UI', Roboto, Helvetica, sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg-color); color: var(--text-main); }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; }
        .logo { font-size: 22px; font-weight: 600; margin-bottom: 40px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px 16px; border-radius: 8px; cursor: pointer; transition: 0.2s; color: #5f6368; margin-bottom: 8px; }
        .nav-item:hover { background: #f1f3f4; }
        .nav-item.active { background: #e8f0fe; color: var(--primary); font-weight: 500; }

        /* Main Chat */
        .main { flex: 1; display: flex; flex-direction: column; position: relative; }
        .chat-box { flex: 1; overflow-y: auto; padding: 40px 15%; }

        .msg { margin-bottom: 24px; display: flex; flex-direction: column; }
        .user-msg { align-items: flex-end; }
        .ai-msg { align-items: flex-start; }

        .bubble {
            max-width: 85%;
            padding: 14px 20px;
            border-radius: 20px;
            font-size: 15px;
            line-height: 1.6;
            white-space: pre-wrap; /* Preserves line breaks */
            word-wrap: break-word;
        }
        .user-msg .bubble { background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .ai-msg .bubble { background: #ffffff; color: var(--text-main); border: 1px solid var(--border); border-bottom-left-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

        /* Input Area */
        .input-wrapper { padding: 20px 15% 40px 15%; background: linear-gradient(transparent, var(--bg-color) 20%); }
        .input-container { background: white; border: 1px solid var(--border); border-radius: 28px; display: flex; padding: 6px 16px; align-items: center; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
        input { flex: 1; border: none; padding: 12px; outline: none; font-size: 16px; }

        /* Thinking Spinner */
        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        button { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: 500; }
        button:disabled { background: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">üêà Nanobot</div>
        <div class="nav-item active">Current Chat</div>
        <div class="nav-item">Workspace</div>
        <div class="nav-item">Settings</div>
    </div>
    <div class="main">
        <div class="chat-box" id="chatBox">
            <div class="msg ai-msg"><div class="bubble">Hello! I am your Nanobot Agent. How can I help you today?</div></div>
        </div>
        <div class="input-wrapper">
            <div class="input-container">
                <div class="spinner" id="spinner"></div>
                <input type="text" id="userInput" placeholder="Ask Nanobot anything..." autocomplete="off">
                <button id="sendBtn" onclick="send()">Send</button>
            </div>
        </div>
    </div>

    <script>
        async function send() {
            const input = document.getElementById('userInput');
            const btn = document.getElementById('sendBtn');
            const spinner = document.getElementById('spinner');
            const text = input.value.trim();

            if (!text) return;

            // Update UI to "Thinking" state
            appendMsg('user', text);
            input.value = '';
            input.disabled = true;
            btn.disabled = true;
            spinner.style.display = 'block';

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({message: text})
                });
                const data = await response.json();
                appendMsg('ai', data.reply);
            } catch (e) {
                appendMsg('ai', 'Error: Could not connect to the server.');
            } finally {
                // Reset UI
                input.disabled = false;
                btn.disabled = false;
                spinner.style.display = 'none';
                input.focus();
            }
        }

        function appendMsg(role, text) {
            const chatBox = document.getElementById('chatBox');
            const div = document.createElement('div');
            div.className = `msg ${role}-msg`;
            div.innerHTML = `<div class="bubble">${text}</div>`;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') send();
        });
    </script>
</body>
</html>